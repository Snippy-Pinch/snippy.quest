<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How It Works | Snippy Private</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #0a0a1a;
            --surface: #111127;
            --surface2: #1a1a35;
            --border: #2a2a4a;
            --primary: #00d4aa;
            --accent: #ff6b6b;
            --warn: #f59e0b;
            --blue: #60a5fa;
            --purple: #a78bfa;
            --pink: #f472b6;
            --text: #e4e4e7;
            --muted: #7a8a9a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.7;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px 80px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--muted);
            text-decoration: none;
            font-size: 0.9rem;
            margin-bottom: 2rem;
            transition: color 0.2s;
        }
        .back-link:hover { color: var(--primary); }

        h1 { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; }
        .subtitle { color: var(--muted); font-size: 1.05rem; margin-bottom: 3rem; }
        h2 { font-size: 1.4rem; font-weight: 700; margin: 3rem 0 1rem; color: var(--primary); }
        h3 { font-size: 1.1rem; font-weight: 600; margin: 2rem 0 0.75rem; }
        p { margin-bottom: 1rem; color: var(--text); }

        .flow {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            overflow-x: auto;
        }

        .flow-title {
            font-size: 0.85rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1.5rem;
        }

        .flow-steps { display: flex; flex-direction: column; gap: 0; }

        .flow-step { display: flex; align-items: flex-start; gap: 16px; }

        .flow-line {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
            width: 40px;
        }

        .flow-dot {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 0.85rem; flex-shrink: 0;
        }

        .flow-connector { width: 3px; height: 40px; background: var(--border); }
        .flow-connector.success { background: var(--primary); }

        .dot-blue { background: rgba(96, 165, 250, 0.2); color: var(--blue); border: 2px solid var(--blue); }
        .dot-purple { background: rgba(167, 139, 250, 0.2); color: var(--purple); border: 2px solid var(--purple); }
        .dot-green { background: rgba(0, 212, 170, 0.2); color: var(--primary); border: 2px solid var(--primary); }
        .dot-yellow { background: rgba(245, 158, 11, 0.2); color: var(--warn); border: 2px solid var(--warn); }
        .dot-pink { background: rgba(244, 114, 182, 0.2); color: var(--pink); border: 2px solid var(--pink); }
        .dot-red { background: rgba(255, 107, 107, 0.2); color: var(--accent); border: 2px solid var(--accent); }

        .flow-content { padding: 8px 0 24px; flex: 1; }
        .flow-label { font-weight: 600; font-size: 0.95rem; margin-bottom: 4px; }
        .flow-desc { font-size: 0.87rem; color: var(--muted); }

        .arch-diagram {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .arch-row {
            display: flex; align-items: center; justify-content: center;
            gap: 12px; margin: 8px 0; flex-wrap: wrap;
        }

        .arch-box {
            padding: 12px 18px; border-radius: 10px;
            font-size: 0.85rem; font-weight: 600; text-align: center; min-width: 120px;
        }

        .arch-box.phone { background: rgba(96, 165, 250, 0.15); border: 2px solid var(--blue); color: var(--blue); }
        .arch-box.cloudflare { background: rgba(245, 158, 11, 0.15); border: 2px solid var(--warn); color: var(--warn); }
        .arch-box.worker { background: rgba(167, 139, 250, 0.15); border: 2px solid var(--purple); color: var(--purple); }
        .arch-box.tunnel { background: rgba(244, 114, 182, 0.15); border: 2px solid var(--pink); color: var(--pink); }
        .arch-box.server { background: rgba(0, 212, 170, 0.15); border: 2px solid var(--primary); color: var(--primary); }
        .arch-box.db { background: rgba(0, 212, 170, 0.25); border: 2px solid var(--primary); color: var(--primary); }
        .arch-box.github { background: rgba(255, 255, 255, 0.08); border: 2px solid #666; color: #999; }
        .arch-box.ms { background: rgba(96, 165, 250, 0.15); border: 2px solid var(--blue); color: var(--blue); }

        .arch-arrow { font-size: 1.2rem; color: var(--muted); }
        .arch-label { text-align: center; font-size: 0.75rem; color: var(--muted); margin: 2px 0 12px; }
        .arch-divider { border: none; border-top: 1px dashed var(--border); margin: 20px 0; }
        .arch-section-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 12px; }

        .sec-table {
            width: 100%; border-collapse: collapse; margin: 1.5rem 0; font-size: 0.9rem;
        }
        .sec-table th {
            text-align: left; padding: 10px 12px; background: var(--surface2);
            color: var(--muted); font-weight: 600; font-size: 0.8rem;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .sec-table td { padding: 10px 12px; border-bottom: 1px solid var(--border); }
        .sec-table tr:last-child td { border-bottom: none; }

        .badge-pass {
            display: inline-block; padding: 2px 10px; border-radius: 6px;
            font-size: 0.8rem; font-weight: 600;
            background: rgba(0, 212, 170, 0.15); color: var(--primary);
        }
        .badge-fail {
            display: inline-block; padding: 2px 10px; border-radius: 6px;
            font-size: 0.8rem; font-weight: 600;
            background: rgba(255, 107, 107, 0.15); color: var(--accent);
        }

        .components {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px; margin: 1.5rem 0;
        }

        .comp-card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 12px; padding: 16px;
        }
        .comp-card h4 { font-size: 0.95rem; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }
        .comp-card p { font-size: 0.83rem; color: var(--muted); margin: 0; }
        .comp-card .comp-detail {
            font-size: 0.78rem; color: var(--border);
            font-family: 'SF Mono', Monaco, monospace;
            margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border);
        }

        .insight {
            background: var(--surface2);
            border-left: 3px solid var(--primary);
            border-radius: 0 10px 10px 0;
            padding: 14px 18px; margin: 1.5rem 0;
        }
        .insight.warn { border-left-color: var(--warn); }
        .insight strong { color: var(--text); }
        .insight p { color: var(--muted); font-size: 0.9rem; margin: 0; }

        .secret-grid { display: grid; grid-template-columns: 1fr; gap: 8px; margin: 1rem 0; }
        .secret-row {
            display: flex; align-items: center; gap: 12px;
            padding: 10px 14px; background: var(--surface);
            border: 1px solid var(--border); border-radius: 8px; font-size: 0.88rem;
        }
        .secret-row .icon { font-size: 1.1rem; flex-shrink: 0; }

        code {
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            background: rgba(0, 212, 170, 0.1);
            padding: 2px 6px; border-radius: 4px; font-size: 0.85em; color: var(--primary);
        }

        .feature-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px; margin: 1.5rem 0;
        }
        .feature-card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 12px; padding: 16px; text-align: center;
        }
        .feature-card .emoji { font-size: 2rem; margin-bottom: 8px; }
        .feature-card h4 { font-size: 0.9rem; margin-bottom: 4px; }
        .feature-card p { font-size: 0.8rem; color: var(--muted); margin: 0; }

        .perf-bar {
            display: flex; align-items: center; gap: 12px;
            padding: 10px 14px; background: var(--surface);
            border: 1px solid var(--border); border-radius: 8px;
            margin-bottom: 8px; font-size: 0.88rem;
        }
        .perf-bar .label { flex: 1; }
        .perf-bar .time {
            font-family: 'SF Mono', Monaco, monospace;
            font-weight: 700; font-size: 0.95rem;
        }
        .perf-bar .time.fast { color: var(--primary); }
        .perf-bar .time.medium { color: var(--warn); }
        .perf-bar .bar-track {
            width: 100px; height: 6px; background: var(--surface2);
            border-radius: 3px; overflow: hidden;
        }
        .perf-bar .bar-fill {
            height: 100%; border-radius: 3px;
        }

        .footer-info {
            text-align: center; margin-top: 4rem; padding-top: 2rem;
            border-top: 1px solid var(--border); color: var(--muted); font-size: 0.8rem;
        }

        @media (max-width: 640px) {
            .container { padding: 30px 16px 60px; }
            h1 { font-size: 1.6rem; }
            .arch-row { flex-direction: column; }
            .arch-arrow { transform: rotate(90deg); }
            .components, .feature-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/private/" class="back-link">‚Üê Private Dashboard</a>

        <h1>üèóÔ∏è How the Live Dashboard Works</h1>
        <p class="subtitle">The full architecture behind <code>/private/today</code> ‚Äî from your browser to Microsoft To Do and back.</p>

        <!-- Features -->
        <h2>‚ú® What It Does</h2>

        <div class="feature-grid">
            <div class="feature-card">
                <div class="emoji">üìã</div>
                <h4>Live Task View</h4>
                <p>Overdue, today, this week, high priority, and backlog ‚Äî all categorized automatically</p>
            </div>
            <div class="feature-card">
                <div class="emoji">‚úÖ</div>
                <h4>One-Click Complete</h4>
                <p>Check off tasks right from the page ‚Äî syncs to MS To Do in under 1 second</p>
            </div>
            <div class="feature-card">
                <div class="emoji">üîÑ</div>
                <h4>Two-Phase Loading</h4>
                <p>Instant display from cache, then background sync with MS To Do for fresh data</p>
            </div>
            <div class="feature-card">
                <div class="emoji">üîò</div>
                <h4>Manual Sync Button</h4>
                <p>Floating refresh button ‚Äî tap anytime to pull latest from Microsoft</p>
            </div>
        </div>

        <!-- Performance -->
        <h2>‚ö° Performance</h2>

        <div class="perf-bar">
            <span class="label">Page load (from DB cache)</span>
            <div class="bar-track"><div class="bar-fill" style="width:3%;background:var(--primary)"></div></div>
            <span class="time fast">~20ms</span>
        </div>
        <div class="perf-bar">
            <span class="label">Task completion (cached list)</span>
            <div class="bar-track"><div class="bar-fill" style="width:10%;background:var(--primary)"></div></div>
            <span class="time fast">~0.8s</span>
        </div>
        <div class="perf-bar">
            <span class="label">Full MS Graph sync (background)</span>
            <div class="bar-track"><div class="bar-fill" style="width:70%;background:var(--warn)"></div></div>
            <span class="time medium">~7s</span>
        </div>

        <div class="insight">
            <p><strong>Why is completion so fast?</strong> Each task's list ID is cached in PostgreSQL during sync. When you check off a task, the API makes a single MS Graph call instead of searching all 16 lists. First-time completions (no cache) fall back to brute-force search.</p>
        </div>

        <!-- Big Picture -->
        <h2>üó∫Ô∏è Architecture Overview</h2>
        <p>A request passes through <strong>5 systems</strong>. Each layer adds security or functionality.</p>

        <div class="arch-diagram">
            <div class="arch-section-label">üì± Your Device</div>
            <div class="arch-row">
                <div class="arch-box phone">üì± Your Browser</div>
            </div>
            <div class="arch-label">‚Üì HTTPS request with auth cookie</div>

            <hr class="arch-divider">
            <div class="arch-section-label">‚òÅÔ∏è Cloudflare Edge (Global CDN)</div>
            <div class="arch-row">
                <div class="arch-box cloudflare">üîí CF Access<br><small>JWT Verification</small></div>
                <div class="arch-arrow">‚Üí</div>
                <div class="arch-box github">üìÑ GitHub Pages<br><small>Static HTML/JS</small></div>
            </div>
            <div class="arch-label">Page loads ‚Üë ¬∑ JS calls /api/* ‚Üì</div>
            <div class="arch-row">
                <div class="arch-box worker">‚ö° CF Worker<br><small>JWT + API Key Injection</small></div>
            </div>
            <div class="arch-label">‚Üì Adds API key ¬∑ ‚ö†Ô∏è Strips POST body (known limitation)</div>

            <hr class="arch-divider">
            <div class="arch-section-label">üîê Cloudflare Tunnel (Encrypted)</div>
            <div class="arch-row">
                <div class="arch-box tunnel">üöá CF Tunnel<br><small>api.snippy.quest</small></div>
            </div>
            <div class="arch-label">‚Üì Encrypted connection to server</div>

            <hr class="arch-divider">
            <div class="arch-section-label">üñ•Ô∏è Snippy's Server (LXC Container)</div>
            <div class="arch-row">
                <div class="arch-box server">üêç Threaded API<br><small>Port 8787</small></div>
                <div class="arch-arrow">‚Üî</div>
                <div class="arch-box db">üêò PostgreSQL<br><small>Task Cache + Analytics</small></div>
            </div>
            <div class="arch-label">‚Üï Reads/writes tasks</div>
            <div class="arch-row">
                <div class="arch-box ms">üìä MS Graph API<br><small>Microsoft To Do</small></div>
            </div>
            <div class="arch-label">‚Üë Sync + complete tasks via OAuth token</div>
        </div>

        <!-- Data Flow -->
        <h2>üîÑ Data Flow: Two-Phase Loading</h2>

        <div class="flow">
            <div class="flow-title">What Happens When You Open the Page</div>
            <div class="flow-steps">

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-blue">1</div>
                        <div class="flow-connector success"></div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">Instant load from database cache (~20ms)</div>
                        <div class="flow-desc">Page fetches <code>GET /api/tasks</code>. The API queries PostgreSQL and returns categorized tasks immediately. You see your tasks in under a second. Status badge shows "Loading cached..."</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-yellow">2</div>
                        <div class="flow-connector success"></div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">Background sync with MS To Do (~7s)</div>
                        <div class="flow-desc">JavaScript silently calls <code>GET /api/tasks/refresh</code>. The API runs a full sync ‚Äî iterates all 16 MS To Do lists via MS Graph API, upserts into PostgreSQL, then returns fresh data. Badge shows "Syncing with MS To Do..."</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-green">3</div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">Page updates seamlessly</div>
                        <div class="flow-desc">Fresh data replaces cached data in-place. Any tasks added in MS To Do since last sync appear instantly. Badge shows "Live ¬∑ synced just now". Hit the floating üîÑ button anytime for another sync.</div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Task Completion Flow -->
        <h2>‚úÖ How Task Completion Works</h2>

        <div class="flow">
            <div class="flow-title">What Happens When You Click a Checkbox</div>
            <div class="flow-steps">

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-green">1</div>
                        <div class="flow-connector success"></div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">Optimistic UI update (instant)</div>
                        <div class="flow-desc">Checkbox fills green with a ‚úì. Task card gets a strikethrough. This happens immediately before the API call ‚Äî makes it feel instant.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-purple">2</div>
                        <div class="flow-connector success"></div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">API call with cached list lookup (~0.8s)</div>
                        <div class="flow-desc">Browser sends <code>POST /api/tasks/complete?id=...</code> (task ID in query string because the CF Worker strips POST bodies). The API looks up the task's <strong>cached list_id</strong> from PostgreSQL, then makes a single PATCH to MS Graph. Without the cache, it would need to search all 16 lists (5-10s).</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-blue">3</div>
                        <div class="flow-connector success"></div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">Database + MS To Do updated simultaneously</div>
                        <div class="flow-desc">MS Graph marks the task completed in To Do. PostgreSQL records completion time, calculates actual hours since creation, and marks the task done.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-green">4</div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">Toast confirmation + animated removal</div>
                        <div class="flow-desc">Green toast: "‚úì Task Name completed". Card fades out and slides away. Counter updates. If the API fails, the checkbox reverts with a red shake animation and error toast.</div>
                    </div>
                </div>

            </div>
        </div>

        <div class="insight warn">
            <p><strong>Why query params instead of POST body?</strong> The Cloudflare Worker proxies API requests but strips the POST body (sends <code>Content-Length: 0</code>). Discovered during development ‚Äî the workaround is sending the task ID as a URL query parameter. GET requests and response bodies work fine.</p>
        </div>

        <!-- Security -->
        <h2>üõ°Ô∏è Security Layers</h2>
        <p>Three independent layers. An attacker needs to break <strong>all three</strong>.</p>

        <div class="flow">
            <div class="flow-title">Defense in Depth</div>
            <div class="flow-steps">
                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-yellow">1</div>
                        <div class="flow-connector"></div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">Cloudflare Access (Gate to /private)</div>
                        <div class="flow-desc">Email PIN authentication. Only 2 email addresses allowed. Requires actual inbox access. Sessions last 30 days.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-purple">2</div>
                        <div class="flow-connector"></div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">JWT Cryptographic Verification (Worker)</div>
                        <div class="flow-desc">RSA-256 signature verification. Checks audience, expiration, and issuer. Forged or expired tokens are rejected instantly. Same technology used by banks.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="flow-line">
                        <div class="flow-dot dot-green">3</div>
                    </div>
                    <div class="flow-content">
                        <div class="flow-label">API Key on Backend</div>
                        <div class="flow-desc">Secret key stored as encrypted Worker secret and server-side file. Never in the browser, never in source code. Required on every API request.</div>
                    </div>
                </div>
            </div>
        </div>

        <table class="sec-table">
            <thead>
                <tr><th>Attack</th><th>What Happens</th><th>Result</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td>Visit /api/tasks directly</td>
                    <td>No CF_Authorization cookie ‚Üí Worker rejects</td>
                    <td><span class="badge-fail">‚ùå Blocked</span></td>
                </tr>
                <tr>
                    <td>Forge a JWT cookie</td>
                    <td>RSA signature check fails</td>
                    <td><span class="badge-fail">‚ùå Blocked</span></td>
                </tr>
                <tr>
                    <td>Use an expired session</td>
                    <td>JWT expiration check fails</td>
                    <td><span class="badge-fail">‚ùå Blocked</span></td>
                </tr>
                <tr>
                    <td>Hit api.snippy.quest directly</td>
                    <td>No API key ‚Üí backend rejects</td>
                    <td><span class="badge-fail">‚ùå Blocked</span></td>
                </tr>
                <tr>
                    <td>Read the GitHub source code</td>
                    <td>No secrets in repo ‚Äî all in Worker secrets + server</td>
                    <td><span class="badge-fail">‚ùå Nothing to find</span></td>
                </tr>
                <tr>
                    <td>Authenticated user with valid session</td>
                    <td>CF Access ‚úÖ ‚Üí JWT ‚úÖ ‚Üí API Key ‚úÖ ‚Üí Data returned</td>
                    <td><span class="badge-pass">‚úÖ Allowed</span></td>
                </tr>
            </tbody>
        </table>

        <!-- Components -->
        <h2>üß© System Components</h2>

        <div class="components">
            <div class="comp-card">
                <h4>üìÑ GitHub Pages</h4>
                <p>Static HTML/CSS/JS. Public repo, zero secrets. Interactive checkboxes, toast notifications, floating sync button.</p>
                <div class="comp-detail">Snippy-Pinch/snippy.quest</div>
            </div>
            <div class="comp-card">
                <h4>üîí Cloudflare Access</h4>
                <p>Email PIN auth for /private/*. Sets JWT cookie. 30-day sessions.</p>
                <div class="comp-detail">2 allowed emails</div>
            </div>
            <div class="comp-card">
                <h4>‚ö° Cloudflare Worker</h4>
                <p>Validates JWT, injects API key, proxies to tunnel. ‚ö†Ô∏è Strips POST body.</p>
                <div class="comp-detail">snippy-api-proxy ¬∑ RS256</div>
            </div>
            <div class="comp-card">
                <h4>üöá Cloudflare Tunnel</h4>
                <p>Encrypted connection to server. No open ports exposed to the internet.</p>
                <div class="comp-detail">api.snippy.quest ‚Üí 127.0.0.1:8787</div>
            </div>
            <div class="comp-card">
                <h4>üêç Threaded API Server</h4>
                <p>Python ThreadingHTTPServer. Handles concurrent requests ‚Äî sync won't block completions.</p>
                <div class="comp-detail">systemd: snippy-todo-api</div>
            </div>
            <div class="comp-card">
                <h4>üêò PostgreSQL</h4>
                <p>Task cache with analytics. Stores list_id for fast completions, tracks hours and history.</p>
                <div class="comp-detail">LXC 702 ¬∑ 10.16.50.71</div>
            </div>
            <div class="comp-card">
                <h4>üìä MS Graph API</h4>
                <p>Microsoft To Do backend. 16 lists, ~150 tasks. OAuth token auto-refreshed on heartbeat.</p>
                <div class="comp-detail">graph.microsoft.com/v1.0</div>
            </div>
            <div class="comp-card">
                <h4>üîÅ Sync Engine</h4>
                <p>Full sync on page load + heartbeat. Creates, updates, completes, detects deletions. Deduplication built in.</p>
                <div class="comp-detail">sync_todos_full.py</div>
            </div>
        </div>

        <!-- Secrets -->
        <h2>üîë Where Secrets Live</h2>
        <div class="secret-grid">
            <div class="secret-row">
                <span class="icon">üîê</span>
                <div>
                    <strong>API Key</strong> ‚Äî CF Worker encrypted secret + server secrets file
                    <br><small style="color: var(--muted);">Never in browser or GitHub repo</small>
                </div>
            </div>
            <div class="secret-row">
                <span class="icon">üîê</span>
                <div>
                    <strong>MS365 OAuth Token</strong> ‚Äî Server /tmp, auto-refreshed every heartbeat
                    <br><small style="color: var(--muted);">Used for MS Graph API calls (sync + complete)</small>
                </div>
            </div>
            <div class="secret-row">
                <span class="icon">üîê</span>
                <div>
                    <strong>Tunnel Token</strong> ‚Äî Server secrets file, loaded by systemd
                    <br><small style="color: var(--muted);">/root/.clawdbot/secrets/cloudflare_tunnel.json</small>
                </div>
            </div>
            <div class="secret-row">
                <span class="icon">üîê</span>
                <div>
                    <strong>Database Credentials</strong> ‚Äî Server secrets file
                    <br><small style="color: var(--muted);">/root/.clawdbot/secrets/postgres.json</small>
                </div>
            </div>
            <div class="secret-row">
                <span class="icon">üîê</span>
                <div>
                    <strong>JWT Signing Keys</strong> ‚Äî Cloudflare's private RSA keys (we only verify with public keys)
                    <br><small style="color: var(--muted);">Managed and rotated by Cloudflare automatically</small>
                </div>
            </div>
        </div>

        <!-- Known Limitations -->
        <h2>‚ö†Ô∏è Known Limitations</h2>

        <table class="sec-table">
            <thead>
                <tr><th>Limitation</th><th>Impact</th><th>Workaround</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td>CF Worker strips POST body</td>
                    <td>Can't send JSON in POST requests</td>
                    <td>Task ID sent as query parameter</td>
                </tr>
                <tr>
                    <td>Background sync takes ~7s</td>
                    <td>New tasks from MS To Do aren't instant</td>
                    <td>Two-phase load: cached first, fresh after</td>
                </tr>
                <tr>
                    <td>No undo for completions</td>
                    <td>Checked tasks can't be unchecked from the page</td>
                    <td>Reopen in MS To Do app directly</td>
                </tr>
                <tr>
                    <td>MS365 token can expire</td>
                    <td>Sync + completion break silently</td>
                    <td>Auto-refresh on heartbeat (~30 min)</td>
                </tr>
                <tr>
                    <td>No real-time push</td>
                    <td>Changes from other devices need manual sync</td>
                    <td>Floating üîÑ button for on-demand refresh</td>
                </tr>
                <tr>
                    <td>Single MS365 account</td>
                    <td>Only Trevor's tasks visible</td>
                    <td>Shared lists work through his account</td>
                </tr>
            </tbody>
        </table>

        <!-- Task Sections -->
        <h2>üìä Task Categories</h2>
        <p>Tasks are automatically sorted into sections based on due date and importance:</p>

        <table class="sec-table">
            <thead>
                <tr><th>Section</th><th>Criteria</th><th>Display</th></tr>
            </thead>
            <tbody>
                <tr><td>üî¥ Overdue</td><td>Due date in the past</td><td>Shows due date</td></tr>
                <tr><td>üìå Due Today</td><td>Due date is today</td><td>No date shown</td></tr>
                <tr><td>üìÖ This Week</td><td>Due within 7 days</td><td>Shows due date</td></tr>
                <tr><td>‚≠ê High Priority</td><td>Marked "important" in MS To Do (any date or no date)</td><td>Top 15 shown</td></tr>
                <tr><td>üì¶ Backlog</td><td>No due date, normal priority</td><td>Top 20 shown</td></tr>
            </tbody>
        </table>

        <div class="footer-info">
            Built by Snippy ü¶Ä ¬∑ Last updated February 19, 2026
            <br>v2: Interactive completions, two-phase loading, threaded API, cached list lookups
        </div>
    </div>
</body>
</html>
